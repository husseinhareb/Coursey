<!-- src/app/forum/forum-thread.component.html -->
<div class="chat-wrapper">
  <div class="chat-container">

    <!-- Header -->
    <header class="chat-header" *ngIf="topic">
      <h2 class="chat-title">{{ topic.title }}</h2>
      <div class="chat-meta">
        {{ 'FORUM_THREAD.CREATED_BY' | translate }}
        <strong>{{ authorNames[topic.author_id] }}</strong>
        {{ 'FORUM_THREAD.ON' | translate }}
        {{ topic.created_at | date:'short' }}
      </div>
    </header>

    <!-- Loading / Error -->
    <div *ngIf="loadingTopic" class="chat-status">Loadingâ€¦</div>
    <div *ngIf="errorTopic"   class="chat-status error">{{ errorTopic }}</div>

    <!-- Messages -->
    <section class="messages" *ngIf="topic && !loadingTopic">
      <ng-container *ngIf="topic.messages.length; else noMessages">
        <div
          *ngFor="let msg of topic.messages"
          class="message"
          [ngClass]="{ outgoing: isOutgoing(msg.author_id), incoming: !isOutgoing(msg.author_id) }"
        >
          <div class="bubble">
            <img
              *ngIf="msg.image_data"
              [src]="toSafeUrl(msg.image_data)"
              alt="attachment"
              class="bubble-image"
            />
            <div class="bubble-text">{{ msg.content }}</div>
            <time class="bubble-time">{{ msg.created_at | date:'shortTime' }}</time>
          </div>
        </div>
      </ng-container>
      <ng-template #noMessages>
        <p class="no-messages">No messages yet. Say hello!</p>
      </ng-template>
    </section>

    <!-- Image preview before send -->
    <div *ngIf="previewUrl" class="preview-container">
      <img [src]="previewUrl" alt="Preview" class="preview-image"/>
      <button type="button" class="remove-btn" (click)="removeImage()">âœ•</button>
    </div>

    <!-- Reply form -->
    <form
      class="chat-footer"
      [formGroup]="messageForm"
      (ngSubmit)="postMessage()"
    >
      <textarea
        formControlName="content"
        class="input"
        rows="1"
        placeholder="Type a messageâ€¦"
        (keydown.enter)="postMessage(); $event.preventDefault()"
      ></textarea>

      <label class="attach">
        <input
          type="file"
          accept="image/*"
          (change)="onFileSelected($event)"
        />
        ðŸ“Ž
      </label>

      <button
        type="submit"
        class="send-btn"
        [disabled]="posting || (!messageForm.value.content && !selectedFile)"
      >âž¤</button>
    </form>

  </div>
</div>
