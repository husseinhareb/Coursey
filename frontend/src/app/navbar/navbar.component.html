<nav class="navbar">
  <!-- LEFT: brand → lang → theme → home -->
  <div class="navbar-left">
    <div class="navbar-brand">
      <a routerLink="/" class="brand">{{ 'NAV.BRAND' | translate }}</a>
    </div>
    <div class="language-picker">
      <i class="fa-solid fa-language language-picker__icon"></i>
      <select
        id="language-picker-select"
        class="language-picker__select li4-btn li4-btn--subtle"
        (change)="onLanguageChange($event)"
        [value]="currentLang"
      >
        <option *ngFor="let lang of translate.getLangs()" [value]="lang" [attr.lang]="lang">
          {{ lang.toUpperCase() }}
        </option>
      </select>
    </div>

    <label id="theme-toggle-button">
      <input
        type="checkbox"
        id="toggle"
        [checked]="theme.isDark()"
        (change)="theme.toggle()"
      />
      <!-- SVG omitted for brevity -->
    </label>

    <a routerLink="/home" routerLinkActive="active" class="nav-link">
      {{ 'NAV.HOME' | translate }}
    </a>
  </div>

  <!-- CENTER: search -->
  <div *ngIf="auth.isLoggedIn" class="navbar-center">
    <div class="search-container">
      <input
        type="text"
        class="search-input"
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearch()"
        placeholder="{{ 'NAV.SEARCH_PLACEHOLDER' | translate }}"
      />
      <div *ngIf="searchResults" class="search-dropdown">
        <ul>
          <li *ngIf="searchResults.courses.length">
            <strong>{{ 'NAV.SEARCH_COURSES' | translate }}</strong>
          </li>
          <li *ngFor="let c of searchResults.courses">
            <a [routerLink]="['/courses', c.id]">{{ c.code }} — {{ c.title }}</a>
          </li>

          <li *ngIf="searchResults.users.length" class="mt-sm">
            <strong>{{ 'NAV.SEARCH_USERS' | translate }}</strong>
          </li>
          <li *ngFor="let u of searchResults.users" class="search-user-item">
            <a
              [routerLink]="['/users', u.id]"
              (click)="onPostClick()"
              class="search-user-link"
            >
              <img
                *ngIf="u.profile.profilePic"
                [src]="u.profile.profilePic"
                alt="{{ u.username }}’s avatar"
                class="search-user-avatar"
              />
              <div class="search-user-info">
                <div class="search-user-name">
                  {{ u.profile.firstName }} {{ u.profile.lastName }}
                </div>
                <div class="search-user-email">{{ u.email }}</div>
              </div>
            </a>
          </li>

          <li *ngIf="searchResults.posts.length" class="mt-sm">
            <strong>{{ 'NAV.SEARCH_POSTS' | translate }}</strong>
          </li>
          <li *ngFor="let p of searchResults.posts">
            <a
              [routerLink]="['/courses', p.course_id, 'posts', p._id]"
              (click)="onPostClick()"
            >
              {{ p.title }}
            </a>
          </li>

          <li
            *ngIf="
              !searchResults.courses.length &&
              !searchResults.users.length &&
              !searchResults.posts.length
            "
          >
            <em>{{ 'NAV.SEARCH_NONE' | translate }}</em>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- RIGHT: links + user info -->
  <div class="navbar-right">
    <a
      *ngIf="!auth.isLoggedIn"
      routerLink="/login"
      routerLinkActive="active"
      class="nav-link"
    >
      {{ 'NAV.LOG_IN' | translate }}
    </a>

    <a
      *ngIf="auth.isLoggedIn && isAdmin"
      routerLink="/users"
      routerLinkActive="active"
      class="nav-link"
    >
      {{ 'NAV.USERS' | translate }}
    </a>
    <a
      *ngIf="auth.isLoggedIn && isAdmin"
      routerLink="/activity-logs"
      routerLinkActive="active"
      class="nav-link"
    >
      {{ 'NAV.ACTIVITY_LOGS' | translate }}
    </a>

    <a
      *ngIf="auth.isLoggedIn"
      routerLink="/courses"
      routerLinkActive="active"
      class="nav-link"
    >
      {{ 'NAV.COURSES' | translate }}
    </a>
    <a
      *ngIf="auth.isLoggedIn"
      routerLink="/profile"
      routerLinkActive="active"
      class="nav-link"
    >
      {{ 'NAV.PROFILE' | translate }}
    </a>

    <!-- New user info block -->
    <div *ngIf="auth.isLoggedIn" class="user-container">
      <div class="avatar-wrapper">
        <img
          *ngIf="auth.user?.profile?.profilePic as pic"
          [src]="pic"
          alt="Avatar"
        />
        <ng-container *ngIf="!auth.user?.profile?.profilePic">
          {{ initials }}
        </ng-container>
      </div>

      <div class="user-details">
        <div class="user-name">
          {{ auth.user?.profile?.firstName }}
        </div>
        <div class="user-role">
          {{ userRole }}
        </div>
      </div>

      <button class="logout-btn" (click)="logout()">
        <i class="fa-solid fa-right-from-bracket"></i>
      </button>
    </div>
  </div>
</nav>
