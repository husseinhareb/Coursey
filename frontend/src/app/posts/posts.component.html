<!-- src/app/posts/posts.component.html -->
<div *ngIf="loading" class="loading">
  <i class="fas fa-spinner fa-spin"></i>
  {{ 'POSTS.LOADING' | translate }}
</div>
<div *ngIf="error" class="error">
  <i class="fas fa-exclamation-triangle"></i>
  {{ error }}
</div>

<ul *ngIf="!loading && !error" class="posts-list">
  <li *ngFor="let p of posts" class="post-card" [id]="p._id">
    <!-- Header -->
    <div class="post-header">
      <h3 class="post-title">
        <i class="fas fa-thumbtack pinned-icon" *ngIf="p.ispinned"></i>
        {{ p.title }}
      </h3>
      <span class="post-badge homework-badge" *ngIf="p.type === 'homework'">
        <i class="fas fa-book"></i> {{ 'POSTS.HOMEWORK_FLAG' | translate }}
      </span>
    </div>

    <!-- Body -->
    <div class="post-body">
      <p>{{ p.content }}</p>
    </div>

    <!-- Meta -->
    <div class="post-meta">
      <span><i class="fas fa-tag"></i> {{ 'POSTS.TYPE' | translate }}: {{ p.type }}</span>
      <span *ngIf="p.ispinned"><i class="fas fa-clock"></i> {{ 'POSTS.PINNED_AT' | translate }}: {{ p.pinnedAt | date:'short' }}</span>
      <span *ngIf="p.type==='homework'"><i class="fas fa-calendar-alt"></i> {{ 'POSTS.DUE_DATE' | translate }}: {{ p.due_date | date:'short' }}</span>
    </div>

    <!-- Admin Actions -->
    <div class="actions admin-actions" *ngIf="canModifyPosts">
      <button class="action-btn" (click)="togglePin.emit(p)" title="{{ p.ispinned ? ('POSTS.UNPIN'|translate) : ('POSTS.PIN'|translate) }}">
        <i class="fas fa-thumbtack" [class.pinned]="p.ispinned"></i>
      </button>
      <button class="action-btn" (click)="moveUp.emit(p)" [disabled]="p.position===1" title="Move Up">
        <i class="fas fa-arrow-up"></i>
      </button>
      <button class="action-btn" (click)="moveDown.emit(p)" [disabled]="p.position===unpinnedCount" title="Move Down">
        <i class="fas fa-arrow-down"></i>
      </button>
      <button class="action-btn" (click)="editPost.emit(p)" title="{{ 'POSTS.EDIT'|translate }}">
        <i class="fas fa-edit"></i>
      </button>
      <button class="action-btn danger" (click)="deletePost.emit(p)" title="{{ 'POSTS.DELETE'|translate }}">
        <i class="fas fa-trash-alt"></i>
      </button>
    </div>

    <!-- Homework & Submission UI -->
    <div *ngIf="p.type === 'homework'" class="actions homework-actions">
      <!-- Submit new HW -->
      <button class="action-btn"
        *ngIf="isStudentInCourse && !studentSubmissions[p._id] && showSubmissionFormForPostId !== p._id"
        (click)="toggleSubmissionForm.emit(p._id)"
        title="{{ 'POSTS.SUBMIT_HW' | translate }}"
      >
        <i class="fas fa-upload"></i> {{ 'POSTS.SUBMIT_HW' | translate }}
      </button>

      <!-- Submission Form -->
      <div *ngIf="showSubmissionFormForPostId === p._id && isStudentInCourse" class="submission-form-wrapper">
        <app-submission-form
          [courseId]="courseId"
          [postId]="p._id"
          (submitted)="onSubmitted()"
          (cancel)="toggleSubmissionForm.emit(null)"
        ></app-submission-form>
      </div>

      <!-- View Own Submissions -->
      <button class="action-btn"
        *ngIf="isStudentInCourse && showOwnSubmissionListForPostId !== p._id"
        (click)="viewOwnSubmission.emit(p._id)"
        title="{{ 'POSTS.VIEW_MY_SUB' | translate }}"
      >
        <i class="fas fa-folder-open"></i> {{ 'POSTS.VIEW_MY_SUB' | translate }}
      </button>
      <div *ngIf="showOwnSubmissionListForPostId === p._id" class="own-submissions">
        <app-submission-list [courseId]="courseId" [postId]="p._id"></app-submission-list>
        <button class="action-btn" (click)="viewOwnSubmission.emit(null)">
          <i class="fas fa-times-circle"></i> {{ 'POSTS.HIDE_MY_SUB' | translate }}
        </button>
      </div>

      <!-- View All Submissions (Admin) -->
      <button class="action-btn"
        *ngIf="canModifyPosts"
        (click)="toggleSubmissionList.emit(p._id)"
        title="{{ showSubmissionListForPostId === p._id ? ('POSTS.HIDE_ALL_SUB'|translate) : ('POSTS.VIEW_ALL_SUB'|translate) }}"
      >
        <i class="fas fa-users"></i>
        {{ showSubmissionListForPostId === p._id ? ('POSTS.HIDE_ALL_SUB'|translate) : ('POSTS.VIEW_ALL_SUB'|translate) }}
      </button>
      <div *ngIf="showSubmissionListForPostId === p._id && canModifyPosts" class="all-submissions">
        <app-submission-list [courseId]="courseId" [postId]="p._id"></app-submission-list>
      </div>
    </div>

    <hr class="post-divider" />
  </li>
</ul>

<div *ngIf="!loading && posts?.length === 0" class="no-posts">
  <i class="fas fa-inbox"></i>
  <p>{{ 'POSTS.NO_POSTS' | translate }}</p>
</div>
